namespace = uufulojihad

country_event = { #Disaster event that triggers one of the following 3 events
    id = uufulojihad.0
    title = uufulojihad.0.t
    desc = uufulojihad.0.d
    picture = RELIGIOUS_WARS_eventPicture

	hidden = yes
	is_triggered_only = yes 	#mald moment 

	immediate = {
		if = {														#First prio is Sokoto
			limit = {
				owns = 1148		#Gobir
				NOT = { has_global_flag = uu_sokoto_happened_flag }
				NOT = { exists = SOK }
			}
			country_event = {
				id = uufulojihad.1
			}
		} else_if = {												#Second prio is Massina
			limit = {
				owns = 1131		#Massina
				NOT = { has_global_flag = uu_massina_happened_flag }
				NOT = { exists = ZAF }
			}
			country_event = {
				id = uufulojihad.2
			}
		} else_if = {												#Third prio is Futatoro
			limit = {
				owns = 2237		#Tekrur 
				NOT = { has_global_flag = uu_futatoro_happened_flag }
				NOT = { exists = FUL }
			}
			country_event = {
				id = uufulojihad.3
			}
		} #if none of these are valid, the disaster should cancel.
	}
	option = {
		name = uufulojihad.0.a
	}
}

country_event = { #Sokoto
    id = uufulojihad.1
    title = uufulojihad.1.t
    desc = uufulojihad.1.d
    picture = RELIGIOUS_WARS_eventPicture
	
	fire_only_once = yes
	major = yes 
	is_triggered_only = yes	
	
	immediate = { #setting up the province divisions
		set_global_flag = uu_sokoto_happened_flag
		remove_country_modifier = uu_fulani_preacher_rejected
		capital_scope = {
			set_province_flag = zflag_1
		}
		if = {
			limit = {
				calc_true_if = {
					all_owned_province = {
						is_overseas = no
						province_is_on_an_island = no
						is_city = yes
					}
					amount = 20
				}
			}
			every_owned_province = {
				limit = {
					any_neighbor_province = { is_capital_of = ROOT }
				}
				set_province_flag = zflag_1
			}
		}
		
		every_owned_province = {
			limit = {
				culture = fulani
				NOT = { is_capital_of = ROOT }
			}
			set_province_flag = zflag_2
		}
		while = { #assign every province to a side
			limit = {
				any_owned_province = {
					OR = {
						NOT = { has_province_flag = zflag_1 }
						NOT = { has_province_flag = zflag_2 }
					}
				}
			}
			random_owned_province = { #assign to loyalists
				limit = {
					NOT = { has_province_flag = zflag_1 }
					NOT = { has_province_flag = zflag_2 }
				}
				set_province_flag = zflag_1
			}
			random_owned_province = { #assign to zealot
				limit = {
					NOT = { has_province_flag = zflag_1 }
					NOT = { has_province_flag = zflag_2 }
					is_overseas = no 
					OR = {
						region = guinea_region
						region = sahel_region
						region = niger_region
					}
				}
				set_province_flag = zflag_2
			}
			random_owned_province = { #assign to loyalists 2
				limit = {
					NOT = { has_province_flag = zflag_1 }
					NOT = { has_province_flag = zflag_2 }
				}
				set_province_flag = zflag_1
			}
		}
		every_owned_province = { #bordergore clean
			limit = {
				has_province_flag = zflag_1
				NOT = { is_capital_of = ROOT }
				is_overseas = no 
				all_neighbor_province = {
					NOT = { has_province_flag = zflag_1 }	
				}
			}
			clr_province_flag = zflag_1
			set_province_flag = zflag_2
		}
		#every_owned_province = { #bordergore clean, advanced?
		#	limit = {
		#		has_province_flag = zflag_1
		#		is_overseas = no 
		#		NOT = { is_capital_of = ROOT }
		#		calc_true_if = {
		#			all_neighbor_province = {
		#				has_province_flag = zflag_2
		#			}
		#			amount = 2
		#		}
		#	}
		#	clr_province_flag = zflag_1
		#	set_province_flag = zflag_2
		#}
		#every_owned_province = { #bordergore clean
		#	limit = {
		#		has_province_flag = zflag_2
		#		all_neighbor_province = {
		#			NOT = { has_province_flag = zflag_2 }
		#		}
		#	}
		#	clr_province_flag = zflag_2
		#	set_province_flag = zflag_1
		#}
	}
	option = { #Side with the rebels
		name = uufulojihad.1.a
		trigger = {
			ai = no
		}
		hidden_effect = { #Exile ruler
			ROOT = { save_event_target_as = old_tag_target }
			if = {
				limit = {
					has_regency = no
				}
				exile_ruler_as = { name = z_exiled_ruler }
				set_global_flag = z_exiled_ruler_flag
			}	
			if = {
				limit = {
					has_heir = yes
				}
				exile_heir_as = z_exiled_heir 
				set_global_flag = z_exiled_heir_flag
			}
			if = {
				limit = {
					has_consort = yes
				}
				exile_consort_as = z_exiled_consort
				set_global_flag = z_exiled_consort_flag
			}
			capital_scope = { set_province_flag = zcapitalflag }
		}

		change_tag = SOK 

		if = {
			limit = {
				NOT = { has_idea_group = SOK_ideas }
			}
			country_event = { id = ideagroups.1 } #Swap Ideas
		}
		SOK = { #Setting up Sokoto
			add_stability = -1
			change_government = monarchy
			add_government_reform = feudal_theocracy
			set_government_rank = 2
			define_ruler = {
				name = "Usman dan Fodio"
				dynasty = "Torodbe"
				adm = 5
				dip = 5
				mil = 5
				min_age = 40
				max_age = 55
				claim = 100
				religion = sunni 
				culture = fulani
			}
			add_ruler_personality = scholar_personality
			add_ruler_personality = inspiring_leader_personality
			add_ruler_personality = zealot_personality
			change_religion = sunni 
			change_primary_culture = fulani 
			add_accepted_culture = hausa
			add_country_modifier = {
				name = uu_fulani_jihad_mod
				duration = 7300 #207
			}
			hidden_effect = {
				change_estate_land_share = {
					estate = estate_dhimmi
					share = -50
				} 
				change_estate_land_share = {
					estate = estate_church
					share = 40
				} 
			}
		}
		custom_tooltip = z_half_country_breakaway_tt
		hidden_effect = { #Because tooltip was so long
			every_province = { #Transferring provinces to new tag
				limit = {
					has_province_flag = zflag_1
				}
				add_core = event_target:old_tag_target
				remove_core = ROOT
			}
		
			release = event_target:old_tag_target

			event_target:old_tag_target = { #Setting up new tag (old tag)
				set_country_flag = uu_war_with_sok
				add_stability = -1
				swap_non_generic_missions = yes 
				if = {
					limit = { has_global_flag = z_exiled_ruler_flag }
					set_ruler = z_exiled_ruler
				}
				if = {
					limit = { has_global_flag = z_exiled_heir_flag }
					set_heir = z_exiled_heir
				}
				if = {
					limit = { has_global_flag = z_exiled_consort_flag }
					set_consort = z_exiled_consort
				}
				adopt_reform_progress = ROOT
				if = {
					limit = {
						NOT = { tag = KBO }
						NOT = { is_year = 1600 }
					}
					change_government = tribal
				}
				add_manpower = 20
				add_treasury = 800
				every_province = {
					limit = {
						has_province_flag = zcapitalflag
					}
					move_capital_effect = yes
					clr_province_flag = zcapitalflag
					build_to_forcelimit = {
						infantry = 0.5
						cavalry = 0.2
						artillery = 0.1
					}
				}
				country_event = {
					id = uufulojihad.99
					days = 30
				}
			}
		}

		if = {
			limit = {
				NOT = { government_rank = 2 }
			}
			event_target:old_tag_target = { set_government_rank = 1 }
		} else_if = {
			limit = {
				government_rank = 3
			}
			event_target:old_tag_target = { set_government_rank = 3 }
		}

		every_subject_country = { #If Sokoto, transfer subjects
			if = {
				limit = {
					is_subject_of_type = vassal 
				}
				ROOT = { free_vassal = PREV }
				event_target:old_tag_target = { vassalize = PREV }
			} else_if = {
				limit = {
					is_subject_of_type = tributary_state
				}
				grant_independence = yes
				event_target:old_tag_target = { 
					create_subject = {
						subject_type = tributary_state
						subject = PREV
					}
				}
			} else = {
				grant_independence = yes
			}
		}

		SOK = {
			declare_war_with_cb = {
				who = event_target:old_tag_target
				casus_belli = cb_crusade
			}
		}	
	}
	option = { #Fight the rebels
		name = uufulojihad.1.b
		custom_tooltip = z_half_country_breakaway_tt
		hidden_effect = {
			every_province = { #Transferring provinces to new tag
				limit = {
					has_province_flag = zflag_2
				}
				add_core = SOK
				remove_core = ROOT
			}
		}
		set_country_flag = uu_war_with_sok
		release = SOK 
		add_stability = -1

		SOK = { #Setting up Sokoto
			add_stability = -1
			change_government = monarchy
			add_government_reform = feudal_theocracy
			set_government_rank = 2
			define_ruler = {
				name = "Usman dan Fodio"
				dynasty = "Torodbe"
				adm = 5
				dip = 5
				mil = 5
				min_age = 40
				max_age = 55
				claim = 100
				religion = sunni 
				culture = fulani
			}
			add_ruler_personality = scholar_personality
			add_ruler_personality = inspiring_leader_personality
			add_ruler_personality = zealot_personality
			change_religion = sunni 
			change_primary_culture = fulani 
			add_accepted_culture = hausa
			hidden_effect = {
				adopt_reform_progress = ROOT
				add_manpower = 20
				add_treasury = 800
				country_event = {
					id = uufulojihad.99
					days = 30
				}
				random_owned_province = {
					limit = {
						culture = hausa 
					}
					move_capital_effect = yes
					build_to_forcelimit = {
						infantry = 0.5
						cavalry = 0.3
						artillery = 0.1
					}
				}
			}
			add_country_modifier = {
				name = uu_fulani_jihad_mod
				duration = 7300 #207
			}
			hidden_effect = {
				change_estate_land_share = {
					estate = estate_dhimmi
					share = -50
				} 
				change_estate_land_share = {
					estate = estate_church
					share = 40
				} 
			}
		}

		SOK = {
			declare_war_with_cb = {
				who = ROOT
				casus_belli = cb_crusade
			}
		}	
	}

	after = { #cleanup
		every_province = {
			limit = {
				has_province_flag = zflag_1
			}
			clr_province_flag = zflag_1
		}
		every_province = {
			limit = {
				has_province_flag = zflag_2
			}
			clr_province_flag = zflag_2
		}
		if = {
			limit = { has_global_flag = z_exiled_ruler_flag }
			clr_global_flag = z_exiled_ruler_flag
		}
		if = {
			limit = { has_global_flag = z_exiled_heir_flag }
			clr_global_flag = z_exiled_heir_flag
		}
		if = {
			limit = { has_global_flag = z_exiled_consort_flag }
			clr_global_flag = z_exiled_consort_flag
		}
	}
}

country_event = { #Massina
    id = uufulojihad.2
    title = uufulojihad.2.t
    desc = uufulojihad.2.d
    picture = RELIGIOUS_WARS_eventPicture
	
	fire_only_once = yes
	major = yes 
	is_triggered_only = yes	
	
	immediate = { #setting up the province divisions
		set_global_flag = uu_massina_happened_flag
		remove_country_modifier = uu_fulani_preacher_rejected
		capital_scope = {
			set_province_flag = zflag_10
		}
		if = {
			limit = {
				calc_true_if = {
					all_owned_province = {
						is_overseas = no
						province_is_on_an_island = no
						is_city = yes
					}
					amount = 20
				}
			}
			every_owned_province = {
				limit = {
					any_neighbor_province = { is_capital_of = ROOT }
				}
				set_province_flag = zflag_10
			}
		}
		every_owned_province = {
			limit = {
				culture = fulani
				NOT = { is_capital_of = ROOT }
			}
			set_province_flag = zflag_20
		}
		while = { #assign every province to a side
			limit = {
				any_owned_province = {
					OR = {
						NOT = { has_province_flag = zflag_10 }
						NOT = { has_province_flag = zflag_20 }
					}
				}
			}
			random_owned_province = { #assign to loyalists
				limit = {
					NOT = { has_province_flag = zflag_10 }
					NOT = { has_province_flag = zflag_20 }
				}
				set_province_flag = zflag_10
			}
			random_owned_province = { #assign to zealot
				limit = {
					NOT = { has_province_flag = zflag_10 }
					NOT = { has_province_flag = zflag_20 }
					is_overseas = no 
					OR = {
						region = guinea_region
						region = sahel_region
						region = niger_region
					}
				}
				set_province_flag = zflag_20
			}
			random_owned_province = { #assign to loyalists 2
				limit = {
					NOT = { has_province_flag = zflag_10 }
					NOT = { has_province_flag = zflag_20 }
				}
				set_province_flag = zflag_10
			}
		}
		every_owned_province = { #bordergore clean
			limit = {
				has_province_flag = zflag_10
				NOT = { is_capital_of = ROOT }
				is_overseas = no 
				all_neighbor_province = {
					NOT = { has_province_flag = zflag_10 }	
				}
			}
			clr_province_flag = zflag_10
			set_province_flag = zflag_20
		}
		#every_owned_province = { #bordergore clean
		#	limit = {
		#		has_province_flag = zflag_20
		#		all_neighbor_province = {
		#			NOT = { has_province_flag = zflag_20 }
		#		}
		#	}
		#	clr_province_flag = zflag_20
		#	set_province_flag = zflag_10
		#}
	}
	option = { #Side with the rebels
		name = uufulojihad.2.a
		trigger = {
			ai = no
		}
		hidden_effect = { #Exile ruler
			ROOT = { save_event_target_as = old_tag_target }
			if = {
				limit = {
					has_regency = no
				}
				exile_ruler_as = { name = z_exiled_ruler }
				set_global_flag = z_exiled_ruler_flag
			}	
			if = {
				limit = {
					has_heir = yes
				}
				exile_heir_as = z_exiled_heir 
				set_global_flag = z_exiled_heir_flag
			}
			if = {
				limit = {
					has_consort = yes
				}
				exile_consort_as = z_exiled_consort
				set_global_flag = z_exiled_consort_flag
			}
			capital_scope = { set_province_flag = zcapitalflag }
		}

		change_tag = ZAF 

		if = {
			limit = {
				NOT = { has_idea_group = SOK_ideas }
			}
			country_event = { id = ideagroups.1 } #Swap Ideas
		}
		ZAF = { #Setting up Massina
			add_stability = -1
			change_government = monarchy
			add_government_reform = feudal_theocracy
			set_government_rank = 2
			define_ruler = {
				name = "Sheikhu Ahmadu"
				dynasty = "Lobbo"
				adm = 3
				dip = 6
				mil = 5
				min_age = 35
				max_age = 50
				claim = 100
				religion = sunni 
				culture = fulani
			}
			add_ruler_personality = scholar_personality
			add_ruler_personality = reformist_personality
			add_ruler_personality = zealot_personality
			change_religion = sunni 
			change_primary_culture = fulani 
			add_accepted_culture = bambara
			add_country_modifier = {
				name = uu_fulani_jihad_mod
				duration = 7300 #207
			}
			hidden_effect = {
				change_estate_land_share = {
					estate = estate_dhimmi
					share = -50
				} 
				change_estate_land_share = {
					estate = estate_church
					share = 40
				} 
			} 
		}
		custom_tooltip = z_half_country_breakaway_tt
		hidden_effect = { #Because tooltip was so long
			every_province = { #Transferring provinces to new tag
				limit = {
					has_province_flag = zflag_10
				}
				add_core = event_target:old_tag_target
				remove_core = ROOT
			}
		
			release = event_target:old_tag_target

			event_target:old_tag_target = { #Setting up new tag (old tag)
				set_country_flag = uu_war_with_zaf
				add_stability = -1
				swap_non_generic_missions = yes 
				if = {
					limit = { has_global_flag = z_exiled_ruler_flag }
					set_ruler = z_exiled_ruler
				}
				if = {
					limit = { has_global_flag = z_exiled_heir_flag }
					set_heir = z_exiled_heir
				}
				if = {
					limit = { has_global_flag = z_exiled_consort_flag }
					set_consort = z_exiled_consort
				}
				adopt_reform_progress = ROOT
				if = {
					limit = {
						NOT = { tag = KBO }
						NOT = { is_year = 1600 }
					}
					change_government = tribal
				}
				add_manpower = 20
				add_treasury = 800
				every_province = {
					limit = {
						has_province_flag = zcapitalflag
					}
					move_capital_effect = yes
					clr_province_flag = zcapitalflag
					build_to_forcelimit = {
						infantry = 0.5
						cavalry = 0.2
						artillery = 0.1
					}
				}
				country_event = {
					id = uufulojihad.99
					days = 30
				}
			}
		}

		if = {
			limit = {
				NOT = { government_rank = 2 }
			}
			event_target:old_tag_target = { set_government_rank = 1 }
		} else_if = {
			limit = {
				government_rank = 3
			}
			event_target:old_tag_target = { set_government_rank = 3 }
		}

		every_subject_country = { #If Massina, transfer subjects
			if = {
				limit = {
					is_subject_of_type = vassal 
				}
				ROOT = { free_vassal = PREV }
				event_target:old_tag_target = { vassalize = PREV }
			} else_if = {
				limit = {
					is_subject_of_type = tributary_state
				}
				grant_independence = yes
				event_target:old_tag_target = { 
					create_subject = {
						subject_type = tributary_state
						subject = PREV
					}
				}
			} else = {
				grant_independence = yes
			}
		}

		ZAF = {
			declare_war_with_cb = {
				who = event_target:old_tag_target
				casus_belli = cb_crusade
			}
		}	
	}
	option = { #Fight the rebels
		name = uufulojihad.2.b
		custom_tooltip = z_half_country_breakaway_tt
		hidden_effect = {
			every_province = { #Transferring provinces to new tag
				limit = {
					has_province_flag = zflag_20
				}
				add_core = ZAF
				remove_core = ROOT
			}
		}
		set_country_flag = uu_war_with_zaf
		release = ZAF 
		add_stability = -1

		ZAF = { #Setting up Massina
			add_stability = -1
			change_government = monarchy
			add_government_reform = feudal_theocracy
			set_government_rank = 2
			define_ruler = {
				name = "Sheikhu Ahmadu"
				dynasty = "Lobbo"
				adm = 3
				dip = 6
				mil = 5
				min_age = 35
				max_age = 50
				claim = 100
				religion = sunni 
				culture = fulani
			}
			add_ruler_personality = scholar_personality
			add_ruler_personality = reformist_personality
			add_ruler_personality = zealot_personality
			change_religion = sunni 
			change_primary_culture = fulani 
			add_accepted_culture = bambara
			hidden_effect = {
				adopt_reform_progress = ROOT
				add_manpower = 20
				add_treasury = 800
				country_event = {
					id = uufulojihad.99
					days = 30
				}
				random_owned_province = {
					limit = {
						culture = bambara 
					}
					move_capital_effect = yes
					build_to_forcelimit = {
						infantry = 0.5
						cavalry = 0.3
						artillery = 0.1
					}
				}
			}
			add_country_modifier = {
				name = uu_fulani_jihad_mod
				duration = 7300 #207
			}
			hidden_effect = {
				change_estate_land_share = {
					estate = estate_dhimmi
					share = -50
				} 
				change_estate_land_share = {
					estate = estate_church
					share = 40
				} 
			}
		}

		ZAF = {
			declare_war_with_cb = {
				who = ROOT
				casus_belli = cb_crusade
			}
		}	
	}

	after = { #cleanup
		every_province = {
			limit = {
				has_province_flag = zflag_10
			}
			clr_province_flag = zflag_10
		}
		every_province = {
			limit = {
				has_province_flag = zflag_20
			}
			clr_province_flag = zflag_20
		}
		if = {
			limit = { has_global_flag = z_exiled_ruler_flag }
			clr_global_flag = z_exiled_ruler_flag
		}
		if = {
			limit = { has_global_flag = z_exiled_heir_flag }
			clr_global_flag = z_exiled_heir_flag
		}
		if = {
			limit = { has_global_flag = z_exiled_consort_flag }
			clr_global_flag = z_exiled_consort_flag
		}
	}
}

country_event = { #Fulo
    id = uufulojihad.3
    title = uufulojihad.3.t
    desc = uufulojihad.3.d
    picture = RELIGIOUS_WARS_eventPicture
	
	fire_only_once = yes
	major = yes 
	is_triggered_only = yes	
	
	immediate = { #setting up the province divisions
		set_global_flag = uu_futatoro_happened_flag
		remove_country_modifier = uu_fulani_preacher_rejected
		if = {
			limit = {
				calc_true_if = {
					all_owned_province = {
						is_overseas = no
						province_is_on_an_island = no
						is_city = yes
					}
					amount = 20
				}
			}
			every_owned_province = {
				limit = {
					any_neighbor_province = { is_capital_of = ROOT }
				}
				set_province_flag = zflag_3
			}
		}
		every_owned_province = {
			limit = {
				culture = fulani
				NOT = { is_capital_of = ROOT }
			}
			set_province_flag = zflag_4
		}
		while = { #assign every province to a side
			limit = {
				any_owned_province = {
					OR = {
						NOT = { has_province_flag = zflag_3 }
						NOT = { has_province_flag = zflag_4 }
					}
				}
			}
			random_owned_province = { #assign to loyalists
				limit = {
					NOT = { has_province_flag = zflag_3 }
					NOT = { has_province_flag = zflag_4 }
				}
				set_province_flag = zflag_3
			}
			random_owned_province = { #assign to zealot
				limit = {
					NOT = { has_province_flag = zflag_3 }
					NOT = { has_province_flag = zflag_4 }
					is_overseas = no 
					OR = {
						region = guinea_region
						region = sahel_region
						region = niger_region
					}
				}
				set_province_flag = zflag_4
			}
			random_owned_province = { #assign to loyalists 2
				limit = {
					NOT = { has_province_flag = zflag_3 }
					NOT = { has_province_flag = zflag_4 }
				}
				set_province_flag = zflag_3
			}
		}
		every_owned_province = { #bordergore clean
			limit = {
				has_province_flag = zflag_3
				NOT = { is_capital_of = ROOT }
				is_overseas = no 
				all_neighbor_province = {
					NOT = { has_province_flag = zflag_3 }	
				}
			}
			clr_province_flag = zflag_3
			set_province_flag = zflag_4
		}
		#every_owned_province = { #bordergore clean
		#	limit = {
		#		has_province_flag = zflag_4
		#		all_neighbor_province = {
		#			NOT = { has_province_flag = zflag_4 }
		#		}
		#	}
		#	clr_province_flag = zflag_4
		#	set_province_flag = zflag_3
		#}
	}
	option = { #Side with the rebels
		name = uufulojihad.3.a
		trigger = {
			ai = no
		}
		hidden_effect = { #Exile ruler
			ROOT = { save_event_target_as = old_tag_target }
			if = {
				limit = {
					has_regency = no
				}
				exile_ruler_as = { name = z_exiled_ruler }
				set_global_flag = z_exiled_ruler_flag
			}	
			if = {
				limit = {
					has_heir = yes
				}
				exile_heir_as = z_exiled_heir 
				set_global_flag = z_exiled_heir_flag
			}
			if = {
				limit = {
					has_consort = yes
				}
				exile_consort_as = z_exiled_consort
				set_global_flag = z_exiled_consort_flag
			}
			capital_scope = { set_province_flag = zcapitalflag }
		}

		change_tag = FUL 

		if = {
			limit = {
				NOT = { has_idea_group = FUL_ideas }
			}
			country_event = { id = ideagroups.1 } #Swap Ideas
		}
		FUL = { #Setting up Fulo
			override_country_name = UUFOUTATORO
			set_global_flag = uu_futatoro_happened_flag
			add_stability = -1
			change_government = monarchy
			add_government_reform = feudal_theocracy
			set_government_rank = 2
			define_ruler = {
				name = "Abdul Kader Kan"
				dynasty = "Torodbe"
				adm = 4
				dip = 4
				mil = 3
				min_age = 45
				max_age = 60
				claim = 100
				religion = sunni 
				culture = fulani
			}
			add_ruler_personality = scholar_personality
			add_ruler_personality = lawgiver_personality #abolitionist
			add_ruler_personality = righteous_personality
			change_religion = sunni 
			change_primary_culture = fulani 
			add_country_modifier = {
				name = uu_fulani_jihad_mod
				duration = 7300 #207
			} 
			hidden_effect = {
				change_estate_land_share = {
					estate = estate_dhimmi
					share = -50
				} 
				change_estate_land_share = {
					estate = estate_church
					share = 40
				} 
			}
		}
		custom_tooltip = z_half_country_breakaway_tt
		hidden_effect = { #Because tooltip was so long
			every_province = { #Transferring provinces to new tag
				limit = {
					has_province_flag = zflag_3
				}
				add_core = event_target:old_tag_target
				remove_core = ROOT
			}
		
			release = event_target:old_tag_target

			event_target:old_tag_target = { #Setting up new tag (old tag)
				set_country_flag = uu_war_with_ful
				add_stability = -1
				swap_non_generic_missions = yes 
				if = {
					limit = { has_global_flag = z_exiled_ruler_flag }
					set_ruler = z_exiled_ruler
				}
				if = {
					limit = { has_global_flag = z_exiled_heir_flag }
					set_heir = z_exiled_heir
				}
				if = {
					limit = { has_global_flag = z_exiled_consort_flag }
					set_consort = z_exiled_consort
				}
				adopt_reform_progress = ROOT
				if = {
					limit = {
						NOT = { tag = KBO }
						NOT = { is_year = 1600 }
					}
					change_government = tribal
				}
				add_manpower = 20
				add_treasury = 800
				every_province = {
					limit = {
						has_province_flag = zcapitalflag
					}
					move_capital_effect = yes
					clr_province_flag = zcapitalflag
					build_to_forcelimit = {
						infantry = 0.5
						cavalry = 0.2
						artillery = 0.1
					}
				}
				country_event = {
					id = uufulojihad.99
					days = 30
				}
			}
		}

		if = {
			limit = {
				NOT = { government_rank = 2 }
			}
			event_target:old_tag_target = { set_government_rank = 1 }
		} else_if = {
			limit = {
				government_rank = 3
			}
			event_target:old_tag_target = { set_government_rank = 3 }
		}

		every_subject_country = { #If Fulo, transfer subjects
			if = {
				limit = {
					is_subject_of_type = vassal 
				}
				ROOT = { free_vassal = PREV }
				event_target:old_tag_target = { vassalize = PREV }
			} else_if = {
				limit = {
					is_subject_of_type = tributary_state
				}
				grant_independence = yes
				event_target:old_tag_target = { 
					create_subject = {
						subject_type = tributary_state
						subject = PREV
					}
				}
			} else = {
				grant_independence = yes
			}
		}

		FUL = {
			declare_war_with_cb = {
				who = event_target:old_tag_target
				casus_belli = cb_crusade
			}
		}	
	}
	option = { #Fight the rebels
		name = uufulojihad.3.b
		custom_tooltip = z_half_country_breakaway_tt
		hidden_effect = {
			every_province = { #Transferring provinces to new tag
				limit = {
					has_province_flag = zflag_4
				}
				add_core = FUL
				remove_core = ROOT
			}
		}
		set_country_flag = uu_war_with_ful
		release = FUL 
		add_stability = -1

		FUL = { #Setting up Fulo
			override_country_name = UUFOUTATORO
			set_global_flag = uu_futatoro_happened_flag
			add_stability = -1
			change_government = monarchy
			add_government_reform = feudal_theocracy
			set_government_rank = 2
			define_ruler = {
				name = "Abdul Kader Kan"
				dynasty = "Torodbe"
				adm = 4
				dip = 4
				mil = 3
				min_age = 45
				max_age = 60
				claim = 100
				religion = sunni 
				culture = fulani
			}
			add_ruler_personality = scholar_personality
			add_ruler_personality = lawgiver_personality #abolitionist
			add_ruler_personality = righteous_personality
			change_religion = sunni 
			change_primary_culture = fulani 
			hidden_effect = {
				adopt_reform_progress = ROOT
				add_manpower = 20
				add_treasury = 800
				country_event = {
					id = uufulojihad.99
					days = 30
				}
				random_owned_province = {
					limit = {
						culture = fulani 
					}
					move_capital_effect = yes
					build_to_forcelimit = {
						infantry = 0.5
						cavalry = 0.3
						artillery = 0.1
					}
				}
			}
			add_country_modifier = {
				name = uu_fulani_jihad_mod
				duration = 7300 #207
			}
			hidden_effect = {
				change_estate_land_share = {
					estate = estate_dhimmi
					share = -50
				} 
				change_estate_land_share = {
					estate = estate_church
					share = 40
				} 
			}
		}

		FUL = {
			declare_war_with_cb = {
				who = ROOT
				casus_belli = cb_crusade
			}
		}	
	}

	after = { #cleanup
		every_province = {
			limit = {
				has_province_flag = zflag_3
			}
			clr_province_flag = zflag_3
		}
		every_province = {
			limit = {
				has_province_flag = zflag_4
			}
			clr_province_flag = zflag_4
		}
		if = {
			limit = { has_global_flag = z_exiled_ruler_flag }
			clr_global_flag = z_exiled_ruler_flag
		}
		if = {
			limit = { has_global_flag = z_exiled_heir_flag }
			clr_global_flag = z_exiled_heir_flag
		}
		if = {
			limit = { has_global_flag = z_exiled_consort_flag }
			clr_global_flag = z_exiled_consort_flag
		}
	}
}

country_event = { #For Fulo to convert peacefully
	id = uufulojihad.10
    title = uufulojihad.10.t
    desc = uufulojihad.10.d
	picture = STREET_SPEECH_eventPicture

	fire_only_once = yes 

	trigger = {
		OR = { 
			primary_culture = fulani
			tag = FUL 
		}
		OR = {
			has_global_flag = uu_sokoto_happened_flag
			has_global_flag = uu_massina_happened_flag
			is_year = 1700
			AND = {
				NOT = { adm = 3 }
				NOT = { dip = 3 }
				NOT = { mil = 3 }
			}
		}
		NOT = { stability = 1 }
		religion_group = muslim
	}

	mean_time_to_happen = {
		days = 1825
	}

	option = {
		name = uufulojihad.10.a
		add_stability = -1
		kill_heir = { allow_new_heir = no }
		tooltip = { kill_ruler = yes }
		if = {
			limit = {
				NOT = { government = monarchy }
			}
			change_government = monarchy
		}
		add_government_reform = feudal_theocracy
		set_government_rank = 2
		override_country_name = UUFOUTATORO
		define_ruler = {
			name = "Abdul Kader Kan"
			dynasty = "Torodbe"
			adm = 4
			dip = 4
			mil = 3
			min_age = 45
			max_age = 60
			claim = 100
			religion = sunni 
			culture = fulani
		}
		add_ruler_personality = scholar_personality
		add_ruler_personality = lawgiver_personality #abolitionist
		add_ruler_personality = righteous_personality
		capital_scope = {
			spawn_rebels = {
				size = 3
				type = pretender_rebels
			}
		}
	}
	option = {
		name = uufulojihad.10.b
		ai_chance = { factor = 0 }
		capital_scope = {
			spawn_rebels = {
				size = 3
				type = sunni_rebels
			}
		}
	}
}

country_event = { #Fulani preachers
	id = uufulojihad.40
    title = uufulojihad.40.t
    desc = uufulojihad.40.d
	picture = STREET_SPEECH_eventPicture

	trigger = {
		NOT = { primary_culture = fulani }
		capital_scope = {
			OR = {
				region = sahel_region
				region = niger_region
			}
			NOT = {
				area = tekrur_area
				area = guinea_area
				area = yamoussoukro_area
				area = western_sahara_area
				area = east_azbin_area
				area = darfur_central_sahara_area 
				area = lower_volta_area
				area = atacora_oueme_area
			}
		}
		had_global_flag = {
			flag = uu_fulani_invasion_happened_flag
			days = 5475
		}
		NOT = {
			has_country_modifier = uu_fulani_preacher_accepted
			has_country_modifier = uu_fulani_preacher_rejected
		}
	}

	mean_time_to_happen = {
		days = 1825
	}

	option = {
		name = uufulojihad.40.a
		custom_tooltip = uu_allow_sokoto
		add_country_modifier = {
			name = uu_fulani_preacher_accepted
			duration = -1
		}
		if = {
			limit = {
				NOT = { accepted_culture = fulani }
				OR = {
					NOT = { government_rank = 3 }
					AND = {
						NOT = { culture_group = sahelian }
						government_rank = 3
					}
				}
			}
			add_accepted_culture = fulani
		} else = {
			add_dip_power = 50
		}
		if = {
			limit = {
				religion = sunni 
			}
			define_advisor = {
				type = theologian
				skill = 3
				cost_multiplier = 0.5
				culture = fulani
				religion = sunni
			}
		}
	}
	option = {
		name = uufulojihad.40.b
		custom_tooltip = uu_crush_sokoto
		add_country_modifier = {
			name = uu_fulani_preacher_rejected
			duration = -1
		}
		if = {
			limit = {
				religion = sunni 
			}
			add_stability = -1
			add_prestige = -15
		} else = {
			add_stability = 1
			add_prestige = 15
		}
		ai_chance = { factor = 0 }
	}
}

country_event = { #giving troops
	id = uufulojihad.99
    title = uufulojihad.99.t
    desc = uufulojihad.99.d
    picture = LAND_MILITARY_eventPicture

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				capital_scope = {
					has_siege = no
				}
			}
			capital_scope = {
				build_to_forcelimit = {
					infantry = 0.5
					cavalry = 0.2
					artillery = 0.1
				}
			}
		} else = {
			random_owned_province = {
				limit = { has_siege = no }
				build_to_forcelimit = {
					infantry = 0.5
					cavalry = 0.2
					artillery = 0.1
				}
			}
		}
	}

	option = {
		name = uufulojihad.99.a
	}
}

# Note: idek why these next two events give so many errors, they work perfectly fine

province_event = { #Theocrats take a province
	id = uufulojihad.100
    title = uufulojihad.100.t
    desc = uufulojihad.100.d
	picture = VILLAGE_BURNING_eventPicture

	trigger = {
		OR = {
			AND = {
				FROM = { has_country_flag = uu_war_with_sok }
				controller = { tag = SOK }
			}
			AND = {
				FROM = { has_country_flag = uu_war_with_zaf }
				controller = { tag = ZAF }
			}
			AND = {
				FROM = { has_country_flag = uu_war_with_ful }
				controller = { tag = FUL }
			}
		}
	}
	immediate = {
		hidden_effect = {
			add_core = controller
			cede_province = controller
			if = {			#Taking forts will capture all adjacent provs.
				limit = { has_fort_building_trigger = yes } 
				every_neighbor_province = {
					limit = {
						owner = {
							OR = {
								has_country_flag = uu_war_with_sok
								has_country_flag = uu_war_with_zaf
								has_country_flag = uu_war_with_ful
							}
							war_with = ROOT
						}
					}
					add_core = controller
					cede_province = controller
				}
			}
		}
	}
	option = {
		name = uufulojihad.100.a 
		tooltip = { cede_province = controller }
	}
}

province_event = { #Monarchists take a province
	id = uufulojihad.101
    title = uufulojihad.101.t
    desc = uufulojihad.101.d
	picture = VILLAGE_BURNING_eventPicture

	trigger = {
		OR = {
			AND = {
				FROM = { tag = SOK }
				controller = { has_country_flag = uu_war_with_sok }
			}
			AND = {
				FROM = { tag = ZAF }
				controller = { has_country_flag = uu_war_with_zaf }
			}
			AND = {
				FROM = { tag = FUL }
				controller = { has_country_flag = uu_war_with_ful }
			}
		}
	}
	immediate = {
		hidden_effect = {
			remove_core = FROM
			cede_province = controller
			if = {			#Taking forts will capture all adjacent provs.
				limit = { has_fort_building_trigger = yes } 
				every_neighbor_province = {
					limit = {
						owner = {
							OR = {
								has_country_flag = uu_war_with_sok
								has_country_flag = uu_war_with_zaf
								has_country_flag = uu_war_with_ful
							}
							war_with = ROOT
						}
					}
					add_core = controller
					cede_province = controller
				}
			}
		}
	}
	option = {
		name = uufulojihad.101.a 
		tooltip = { cede_province = controller }
	}
}